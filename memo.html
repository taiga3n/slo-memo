<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>スロ速メモ</title>
<meta name="theme-color" content="#0b0b0f" />
<style>
:root{
  --bg:#0b0b0f; --card:#151520; --ink:#f2f2f7; --muted:#a7a7b3;
  --line:#2a2a36; --acc:#4da3ff; --bad:#ff5c5c; --btn:#1e1e2a;
}
*{box-sizing:border-box}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;
  padding: env(safe-area-inset-top) 12px env(safe-area-inset-bottom) 12px;
}
header{display:flex;justify-content:space-between;align-items:center;padding:10px 4px}
h1{margin:0;font-size:20px}
.tab{padding:10px 14px;border-radius:16px;border:1px solid var(--line);background:transparent;color:var(--ink)}
.tab.active{background:var(--btn);border-color:transparent}
.card{
  background:var(--card);border:1px solid var(--line);
  border-radius:18px;padding:14px;margin-bottom:12px
}
label{font-size:12px;color:var(--muted);margin:14px 0 8px;display:block}
input,textarea{
  width:100%;padding:14px;border-radius:16px;
  border:1px solid var(--line);background:#0f0f16;color:var(--ink);font-size:17px
}
textarea{min-height:80px}
.stack{display:flex;flex-direction:column;gap:14px}
.row{display:flex;gap:10px;flex-wrap:wrap}
button{
  padding:12px 14px;border-radius:16px;
  border:1px solid var(--line);background:var(--btn);color:var(--ink)
}
.primary{background:var(--acc);border-color:transparent;color:#001427;font-weight:800}
.danger{background:transparent;border-color:var(--bad);color:var(--bad)}
.actions{display:flex;flex-direction:column;gap:12px;margin-top:12px}
.toast{
  position:fixed;left:50%;transform:translateX(-50%);
  bottom:calc(env(safe-area-inset-bottom)+16px);
  background:#0f0f16;border:1px solid var(--line);
  padding:10px 14px;border-radius:999px;font-size:13px;
  opacity:0;transition:.2s
}
.toast.show{opacity:1}
.items{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.item{border:1px solid var(--line);border-radius:16px;padding:12px;background:#0f0f16}
.small{font-size:12px;color:var(--muted)}
</style>
</head>

<body>
<header>
  <h1>スロ速メモ</h1>
  <div>
    <button id="tabAdd" class="tab active">追加</button>
    <button id="tabList" class="tab">履歴</button>
  </div>
</header>

<section id="add" class="card">
  <div class="stack">
    <div>
      <label>日付</label>
      <div class="row">
        <button id="today">今日</button>
        <button id="yesterday">昨日</button>
      </div>
      <input id="date" type="date">
    </div>

    <div>
      <label>台番</label>
      <div class="row">
        <button id="daiMinus">-1</button>
        <button id="daiPlus">+1</button>
      </div>
      <input id="dai" inputmode="numeric" placeholder="1141">
    </div>

    <div>
      <label>当該ゲーム数（G）</label>
      <input id="games" inputmode="numeric" placeholder="15178">
    </div>

    <div>
      <label>スルー回数</label>
      <div class="row">
        <button id="suruMinus">-1</button>
        <button id="suruPlus">+1</button>
        <button id="suruZero">0</button>
      </div>
      <input id="suru" inputmode="numeric" placeholder="3">
    </div>

    <div>
      <label>メモ</label>
      <textarea id="memo" placeholder="有利切れっぽい…"></textarea>
    </div>
  </div>

  <div class="actions">
    <button id="save" class="primary">保存（最速）</button>
    <button id="saveNext">保存して次（台番+1）</button>
    <button id="reset" class="danger">入力リセット</button>
  </div>
</section>

<section id="list" class="card" style="display:none">
  <button id="copy">表示中をコピー</button>
  <div class="small">※ そのままLINEやメモに貼れます</div>
  <div id="items" class="items"></div>
</section>

<div id="toast" class="toast"></div>

<script>
const LS="slo_memo_v3";
const $=id=>document.getElementById(id);
const toast=$("toast");
const buzz=()=>navigator.vibrate&&navigator.vibrate(20);
const show=t=>{toast.textContent=t;toast.classList.add("show");setTimeout(()=>toast.classList.remove("show"),1200)}
const today=()=>new Date().toISOString().slice(0,10);
const yesterday=()=>{const d=new Date();d.setDate(d.getDate()-1);return d.toISOString().slice(0,10)}

$("today").onclick=()=>$("date").value=today();
$("yesterday").onclick=()=>$("date").value=yesterday();

$("daiMinus").onclick=()=>{$("dai").value=($("dai").value|0)-1;buzz()}
$("daiPlus").onclick=()=>{$("dai").value=($("dai").value|0)+1;buzz()}
$("suruMinus").onclick=()=>{$("suru").value=Math.max(0,($("suru").value|0)-1);buzz()}
$("suruPlus").onclick=()=>{$("suru").value=($("suru").value|0)+1;buzz()}
$("suruZero").onclick=()=>{$("suru").value=0;buzz()}

const load=()=>JSON.parse(localStorage.getItem(LS)||"[]");
const saveAll=d=>localStorage.setItem(LS,JSON.stringify(d));

$("save").onclick=()=>save(false);
$("saveNext").onclick=()=>save(true);

function save(next){
  if(!$("dai").value||!$("games").value){show("未入力あり");return}
  const r={
    date:$("date").value||yesterday(),
    dai:$("dai").value,
    games:$("games").value,
    suru:$("suru").value||0,
    memo:$("memo").value.trim()
  };
  const d=load();d.unshift(r);saveAll(d);
  show("保存した");buzz();
  $("games").value="";$("suru").value="";$("memo").value="";
  if(next)$("dai").value=Number(r.dai)+1;
  $("dai").focus();
}

$("copy").onclick=async()=>{
  const lines=load().map(r=>
    `${r.date} 台${r.dai} ${r.games}G スルー${r.suru}${r.memo?" "+r.memo:""}`
  ).join("\n");
  try{
    await navigator.clipboard.writeText(lines);
    show("コピーした");buzz();
  }catch{
    alert(lines);
  }
}

$("tabAdd").onclick=()=>{add.style.display="";list.style.display="none";tabAdd.classList.add("active");tabList.classList.remove("active")}
$("tabList").onclick=()=>{render();add.style.display="none";list.style.display="";tabList.classList.add("active");tabAdd.classList.remove("active")}

function render(){
  $("items").innerHTML="";
  load().forEach(r=>{
    const d=document.createElement("div");
    d.className="item";
    d.textContent=`${r.date} 台${r.dai} ${r.games}G スルー${r.suru} ${r.memo||""}`;
    $("items").appendChild(d);
  });
}

$("reset").onclick=()=>{ $("games").value="";$("suru").value="";$("memo").value="";show("リセット");buzz() }

$("date").value=yesterday();
setTimeout(()=>$("dai").focus(),200);
</script>
</body>
</html>
