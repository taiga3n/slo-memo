<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>メモ</title>
<meta name="theme-color" content="#0b0b0f" />
<style>
:root{
  --bg:#0b0b0f; --card:#151520; --ink:#f2f2f7; --muted:#a7a7b3;
  --line:#2a2a36; --acc:#4da3ff; --bad:#ff5c5c; --btn:#1e1e2a;
}

/* ===== 全体をほんの少し縮小 ===== */
html{font-size:15px}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;
  padding:
    env(safe-area-inset-top)
    10px
    calc(env(safe-area-inset-bottom) + 8px)
    10px;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:8px 2px;
}

h1{margin:0;font-size:19px}

.tab{
  padding:8px 12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:transparent;
  color:var(--ink);
}
.tab.active{background:var(--btn);border-color:transparent}

.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:16px;
  padding:12px;
  margin-bottom:10px;
}

label{
  font-size:11px;
  color:var(--muted);
  margin:10px 0 6px;
  display:block;
}

/* ===== 入力欄共通 ===== */
input,textarea{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:#0f0f16;
  color:var(--ink);
  font-size:16px;
}

/* ===== iOS date input対策（はみ出し防止） ===== */
input[type="date"]{
  height:44px;
  line-height:20px;
  appearance:none;
  -webkit-appearance:none;
}

/* placeholderを完全に消す（薄文字不要） */
::placeholder{color:transparent}

textarea{min-height:70px}

.stack{display:flex;flex-direction:column;gap:10px}
.row{display:flex;gap:8px;flex-wrap:wrap}

button{
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--line);
  background:var(--btn);
  color:var(--ink);
  font-size:14px;
}

button:disabled{opacity:.5}

.primary{
  background:var(--acc);
  border-color:transparent;
  color:#001427;
  font-weight:800;
}

.danger{
  background:transparent;
  border-color:var(--bad);
  color:var(--bad);
}

.actions{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:10px;
}

/* ===== 履歴 ===== */
.items{display:flex;flex-direction:column;gap:8px;margin-top:10px}
.item{
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px;
  background:#0f0f16;
  white-space:pre-wrap;
}
.item.editing{outline:2px solid var(--acc)}

.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:calc(env(safe-area-inset-bottom) + 12px);
  background:#0f0f16;
  border:1px solid var(--line);
  padding:8px 12px;
  border-radius:999px;
  font-size:12px;
  opacity:0;
  transition:.2s;
}
.toast.show{opacity:1}
</style>
</head>

<body>
<header>
  <h1>メモ</h1>
  <div>
    <button id="tabAdd" class="tab active" type="button">追加</button>
    <button id="tabList" class="tab" type="button">履歴</button>
  </div>
</header>

<section id="add" class="card">
  <div class="stack">
    <div>
      <label>日付</label>
      <input id="date" type="date">
    </div>

    <div>
      <label>台番</label>
      <input id="dai" inputmode="numeric">
    </div>

    <div>
      <label>当該ゲーム数（G）</label>
      <input id="games" inputmode="numeric">
    </div>

    <div>
      <label>スルー回数</label>
      <input id="suru" inputmode="numeric">
    </div>

    <div>
      <label>メモ</label>
      <textarea id="memo"></textarea>
    </div>
  </div>

  <div class="actions">
    <button id="save" class="primary">保存</button>
    <button id="saveNext">保存して次</button>
    <button id="reset" class="danger">入力リセット</button>
  </div>
</section>

<section id="list" class="card" style="display:none">
  <button id="copy">表示中をコピー</button>
  <button id="clearAll" class="danger" style="margin-top:6px">履歴を全て削除</button>
  <div id="items" class="items"></div>
</section>

<div id="toast" class="toast"></div>

<script>
(() => {
  const LS="slo_memo_v3";
  const $=id=>document.getElementById(id);
  const load=()=>JSON.parse(localStorage.getItem(LS)||"[]");
  const saveAll=d=>localStorage.setItem(LS,JSON.stringify(d));
  let editIndex=null;

  const render=()=>{
    $("items").innerHTML="";
    load().forEach((r,i)=>{
      const d=document.createElement("div");
      d.className="item"+(i===editIndex?" editing":"");
      d.textContent=`${r.dai}番 ${r.games}G スルー${r.suru}${r.memo?" "+r.memo:""}`;
      d.onclick=()=>startEdit(i);
      $("items").appendChild(d);
    });
  };

  const startEdit=i=>{
    const r=load()[i];
    editIndex=i;
    date.value=r.date;
    dai.value=r.dai;
    games.value=r.games;
    suru.value=r.suru;
    memo.value=r.memo;
    save.textContent="上書き保存";
    saveNext.disabled=true;
    tabAdd.click();
  };

  save.onclick=()=>{
    if(!dai.value||!games.value)return;
    const d=load();
    const r={
      date:date.value,
      dai:dai.value,
      games:games.value,
      suru:suru.value||0,
      memo:memo.value.trim()
    };
    if(editIndex!==null){
      d[editIndex]=r;
      editIndex=null;
      save.textContent="保存";
      saveNext.disabled=false;
    }else{
      d.unshift(r);
    }
    saveAll(d);
    reset.click();
  };

  saveNext.onclick=()=>{
    save.click();
    dai.value=Number(dai.value||0)+1;
    dai.focus();
  };

  reset.onclick=()=>{
    editIndex=null;
    save.textContent="保存";
    saveNext.disabled=false;
    games.value="";suru.value="";memo.value="";
  };

  copy.onclick=()=>{
    const t=load().map(r=>`${r.dai}番 ${r.games}G スルー${r.suru}${r.memo?" "+r.memo:""}`).join("\n");
    navigator.clipboard.writeText(t);
  };

  clearAll.onclick=()=>{
    if(confirm("履歴を全て削除します。よろしいですか？")){
      localStorage.removeItem(LS);
      render();
    }
  };

  tabAdd.onclick=()=>{add.style.display="";list.style.display="none"};
  tabList.onclick=()=>{render();add.style.display="none";list.style.display=""};

  date.value=new Date().toISOString().slice(0,10);
})();
</script>
</body>
</html>


